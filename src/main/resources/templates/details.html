<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>–î–µ—Ç–∞–ª—ñ –≤–∞–∫–∞–Ω—Å—ñ—ó</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<div class="container py-5">
  <a href="/" class="btn btn-outline-secondary mb-3">
    <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É
  </a>

  <div class="row">
    <div class="col-md-8">
      <div class="card shadow-sm mb-4">
        <div class="card-body">

          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h2 class="card-title mb-1" th:text="${vacancy.title}">Java Developer</h2>
              <div class="text-muted small mb-2">
                <i class="bi bi-clock"></i> –î–æ–¥–∞–Ω–æ: <span th:text="${#temporals.format(vacancy.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
              </div>
            </div>

            <a th:href="@{/favorite/{id}(id=${vacancy.id})}" class="btn btn-lg"
               th:classappend="${vacancy.isFavorite} ? 'text-warning' : 'text-secondary'"
               title="–î–æ–¥–∞—Ç–∏/–ü—Ä–∏–±—Ä–∞—Ç–∏ –∑ –æ–±—Ä–∞–Ω–æ–≥–æ">
              <i th:class="${vacancy.isFavorite} ? 'bi bi-star-fill' : 'bi bi-star'"></i>
            </a>
          </div>

          <h5 class="text-primary mb-4 fw-bold">
            <i class="bi bi-building"></i> <span th:text="${vacancy.company}">Company</span>
          </h5>

          <div class="d-flex flex-wrap align-items-center gap-2 mb-4 p-3 bg-light rounded border">

            <div class="btn-group">
              <button type="button" class="btn btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"
                      th:text="${vacancy.status}"
                      th:classappend="${vacancy.status.name() == 'NEW' ? 'btn-primary' :
                                 (vacancy.status.name() == 'APPLIED' ? 'btn-warning' :
                                 (vacancy.status.name() == 'INTERVIEW' ? 'btn-info' :
                                 (vacancy.status.name() == 'OFFER' ? 'btn-success' :
                                 (vacancy.status.name() == 'REJECTED' ? 'btn-danger' : 'btn-secondary'))))}">
                –°—Ç–∞—Ç—É—Å
              </button>
              <ul class="dropdown-menu">
                <li><form action="/status/update" method="post"><input type="hidden" name="id" th:value="${vacancy.id}"><button type="submit" name="status" value="NEW" class="dropdown-item">üÜï –ù–æ–≤–∞</button></form></li>
                <li><form action="/status/update" method="post"><input type="hidden" name="id" th:value="${vacancy.id}"><button type="submit" name="status" value="APPLIED" class="dropdown-item">üì§ –í—ñ–¥–≥—É–∫–Ω—É–≤—Å—è</button></form></li>
                <li><form action="/status/update" method="post"><input type="hidden" name="id" th:value="${vacancy.id}"><button type="submit" name="status" value="INTERVIEW" class="dropdown-item">üé§ –°–ø—ñ–≤–±–µ—Å—ñ–¥–∞</button></form></li>
                <li><form action="/status/update" method="post"><input type="hidden" name="id" th:value="${vacancy.id}"><button type="submit" name="status" value="OFFER" class="dropdown-item">üéâ –û—Ñ—Ñ–µ—Ä</button></form></li>
                <li><hr class="dropdown-divider"></li>
                <li><form action="/status/update" method="post"><input type="hidden" name="id" th:value="${vacancy.id}"><button type="submit" name="status" value="REJECTED" class="dropdown-item text-danger">‚õî –í—ñ–¥–º–æ–≤–∞</button></form></li>
              </ul>
            </div>

            <span class="badge bg-white text-dark border" th:if="${vacancy.source != null}">
                            <i class="bi bi-globe"></i> <span th:text="${vacancy.source.name}">DOU</span>
                        </span>

            <span class="badge bg-success" th:if="${vacancy.salary != null && vacancy.salary != ''}">
                            <i class="bi bi-cash-stack"></i> <span th:text="${vacancy.salary}">$$$</span>
                        </span>

            <span class="badge bg-info text-dark" th:if="${vacancy.city != null}">
                            <i class="bi bi-geo-alt-fill"></i> <span th:text="${vacancy.city}">City</span>
                        </span>

            <span class="badge bg-secondary" th:if="${vacancy.technology != null}" th:text="${vacancy.technology}">Tech</span>

            <span class="badge bg-dark" th:if="${vacancy.level != null && !#strings.isEmpty(vacancy.level)}">
                            <i class="bi bi-briefcase-fill"></i>
                            <span th:switch="${vacancy.level}">
                                <span th:case="'0'">–ë–µ–∑ –¥–æ—Å–≤—ñ–¥—É</span>
                                <span th:case="'1'">1 —Ä—ñ–∫</span>
                                <span th:case="'2'">2 —Ä–æ–∫–∏</span>
                                <span th:case="'3'">3 —Ä–æ–∫–∏</span>
                                <span th:case="'4'">4 —Ä–æ–∫–∏</span>
                                <span th:case="'5'">5+ —Ä–æ–∫—ñ–≤</span>
                                <span th:case="*" th:text="${#strings.capitalize(vacancy.level)}">Junior</span>
                            </span>
                        </span>

            <span class="badge bg-warning text-dark border" th:if="${vacancy.englishLevel != null && vacancy.englishLevel != ''}">
                            <i class="bi bi-translate"></i> <span th:text="${vacancy.englishLevel}">Upper</span>
                        </span>

          </div>

          <hr>
          <h6 class="fw-bold">–û–ø–∏—Å –≤–∞–∫–∞–Ω—Å—ñ—ó:</h6>
          <p class="card-text text-break" style="white-space: pre-wrap; font-size: 0.95rem; color: #333;"
             th:text="${vacancy.description}">
            Description...
          </p>

          <a th:href="${vacancy.link}" target="_blank" class="btn btn-primary mt-3 btn-lg w-100">
            –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ <span th:text="${vacancy.source != null ? vacancy.source.name : '—Å–∞–π—Ç'}">–°–∞–π—Ç</span>
            <i class="bi bi-box-arrow-up-right ms-2"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm sticky-top" style="top: 20px;">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">üìù –ù–æ—Ç–∞—Ç–∫–∏</h5>
          <span class="badge bg-secondary rounded-pill" th:text="${vacancy.notes.size()}">0</span>
        </div>
        <div class="card-body">
          <div th:each="note : ${vacancy.notes}" class="alert alert-warning mb-2 position-relative shadow-sm">
            <small class="text-muted d-block mb-1 border-bottom pb-1" style="font-size: 0.75rem;">
              <i class="bi bi-calendar3"></i> <span th:text="${#temporals.format(note.createdAt, 'dd.MM HH:mm')}">Date</span>
            </small>
            <span style="white-space: pre-wrap;" th:text="${note.content}">Note content</span>

            <a th:href="@{/api/vacancies/notes/{noteId}(noteId=${note.id})}"
               onclick="if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –Ω–æ—Ç–∞—Ç–∫—É?')) return false; fetch(this.href, {method: 'DELETE'}).then(() => location.reload()); return false;"
               class="position-absolute top-0 end-0 p-2 text-danger opacity-50 hover-opacity-100"
               style="text-decoration: none;" title="–í–∏–¥–∞–ª–∏—Ç–∏">
              <i class="bi bi-x-circle-fill"></i>
            </a>
          </div>

          <div th:if="${#lists.isEmpty(vacancy.notes)}" class="text-muted text-center mb-3 py-4 bg-light rounded border border-dashed">
            <i class="bi bi-journal-text fs-1 d-block mb-2"></i>
            <small>–ù–æ—Ç–∞—Ç–æ–∫ –ø–æ–∫–∏ –Ω–µ–º–∞—î.<br>–ó–∞–ø–∏—à—ñ—Ç—å —â–æ—Å—å –≤–∞–∂–ª–∏–≤–µ!</small>
          </div>

          <hr>
          <form action="/note/add" method="post">
            <input type="hidden" name="vacancyId" th:value="${vacancy.id}">
            <div class="mb-2">
              <label class="form-label visually-hidden">–¢–µ–∫—Å—Ç –Ω–æ—Ç–∞—Ç–∫–∏</label>
              <textarea name="content" class="form-control" rows="3" placeholder="–ü–∏—Ç–∞–Ω–Ω—è –∑ —ñ–Ω—Ç–µ—Ä–≤'—é, –∫–æ–Ω—Ç–∞–∫—Ç–∏ HR..." required></textarea>
            </div>
            <button type="submit" class="btn btn-dark w-100">
              <i class="bi bi-plus-lg"></i> –î–æ–¥–∞—Ç–∏ –Ω–æ—Ç–∞—Ç–∫—É
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>